{% extends "modelo.html" %}
{% block conteudo %}
<link rel="stylesheet" href="../static/styles/perfil.css">
<body>
    <main>
        <section>
            <form action="/atualizar_perfil" method="post" enctype="multipart/form-data" class="container-principal">
                <h2>Perfil</h2>

                <div class="profile-container" id="profile-container">
                    <div class="profile-image">
                        <!-- Pré-visualização da imagem do perfil -->
                        <img id="profile-img" src="{{ url_for('imagem_perfil', id_cliente=session['usuario_logado']['id_cliente']) }}" alt="Imagem do Perfil" width="150" height="150" onerror="this.src='../static/img/default-avatar.png';">
                    </div>
                    
                    <div class="overlay">
                        <!-- Input para seleção da nova imagem -->
                        <input type="file" id="file-upload" name="imagem_perfil" accept="image/png, image/jpeg" onchange="previewImage(event)">
                        <img src="../static/img/btn-editar.png" alt="Imagem Sobreposta" class="overlay-image">
                    </div>
                </div>
                
                <div class="formulario">
                    <div class="form">
                        <input placeholder="*Nome" type="text" name="nome" required value="{{ session['usuario_logado']['nome_comp'] }}">

                        <input type="password" id="password" name="senha" placeholder="*Senha" required>
                        <button type="button" class="toggle-button" onclick="togglePassword1(event)">
                            <img id="toggle-icon" src="../static/img/fecheido-removebg.png" alt="Mostrar Senha" width="20" height="20">
                        </button>

                        <input placeholder="*Confirmar Senha" id="passwordConfirmar" name="confirmar_senha" type="password" required>
                        <button type="button" class="toggle-button2" onclick="togglePassword2(event)">
                            <img id="toggle-icon2" src="../static/img/fecheido-removebg.png" alt="Mostrar Senha" width="20" height="20">
                        </button>

                        <button class="btn-confirmar" type="submit">Confirmar Mudanças</button>
                    </div>
                </div>
            </form>
        </section>
    </main>

    <!-- Script para pré-visualizar a imagem selecionada -->
    <script>
        function previewImage(event) {
            var input = event.target;  // O input file
            var reader = new FileReader();

            reader.onload = function() {
                var dataURL = reader.result;  // O resultado será o URL da imagem
                var imgElement = document.getElementById('profile-img');  // Seleciona a tag img
                imgElement.src = dataURL;  // Define o src da imagem como o novo URL gerado
            };

            if (input.files && input.files[0]) {
                reader.readAsDataURL(input.files[0]);  // Lê a imagem selecionada e chama o onload
            }
        }

        // Funções para exibir e ocultar senha
        function togglePassword1(event) {
            event.preventDefault();
            const passwordField = document.getElementById('password');
            const toggleIcon = document.getElementById('toggle-icon');

            passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
            toggleIcon.src = passwordField.type === 'text' ? './static/img/abrido-removebg.png' : './static/img/fecheido-removebg.png';
            toggleIcon.alt = passwordField.type === 'text' ? 'Ocultar Senha' : 'Mostrar Senha';
        }

        function togglePassword2(event) {
            event.preventDefault();
            const passwordField = document.getElementById('passwordConfirmar');
            const toggleIcon = document.getElementById('toggle-icon2');

            passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
            toggleIcon.src = passwordField.type === 'text' ? './static/img/abrido-removebg.png' : './static/img/fecheido-removebg.png';
            toggleIcon.alt = passwordField.type === 'text' ? 'Ocultar Senha' : 'Mostrar Senha';
        }
    </script>
</body>
{% endblock %}
